---
description: 
globs: 
alwaysApply: true
---
# å¼€å‘å·¥ä½œæµç¨‹ä¸Gitè§„èŒƒ

## ğŸš€ å¼€å‘å·¥ä½œæµç¨‹

### æœ¬åœ°å¼€å‘ç¯å¢ƒè®¾ç½®
```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/volcengine-go-server.git
cd volcengine-go-server

# 2. å®‰è£…ä¾èµ–
go mod download

# 3. å¤åˆ¶ç¯å¢ƒå˜é‡é…ç½®
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶é…ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡

# 4. å¯åŠ¨ä¾èµ–æœåŠ¡ (MongoDB + Redis)
docker-compose up -d mongodb redis

# 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
make dev
# æˆ–è€…ä½¿ç”¨ Air çƒ­é‡è½½
air -c .air.toml

# 6. å¯åŠ¨é˜Ÿåˆ—å·¥ä½œå™¨
air -c .air.worker.toml
```

### å¼€å‘åˆ†æ”¯ç­–ç•¥
```
main (ç”Ÿäº§åˆ†æ”¯)
â”œâ”€â”€ develop (å¼€å‘åˆ†æ”¯)
â”‚   â”œâ”€â”€ feature/ai-image-generation (åŠŸèƒ½åˆ†æ”¯)
â”‚   â”œâ”€â”€ feature/task-queue-optimization (åŠŸèƒ½åˆ†æ”¯)
â”‚   â””â”€â”€ hotfix/critical-bug-fix (çƒ­ä¿®å¤åˆ†æ”¯)
```

## ğŸ“ Git æäº¤è§„èŒƒ

### æäº¤æ¶ˆæ¯æ ¼å¼
```
<type>: <ä¸­æ–‡æè¿°>

[å¯é€‰çš„è¯¦ç»†è¯´æ˜]

[å¯é€‰çš„å…³è”Issue]
```

### æäº¤ç±»å‹ (type)
- **feat**: æ–°åŠŸèƒ½
- **fix**: ä¿®å¤bug
- **docs**: æ–‡æ¡£æ›´æ–°
- **style**: ä»£ç æ ¼å¼è°ƒæ•´ (ä¸å½±å“åŠŸèƒ½)
- **refactor**: ä»£ç é‡æ„
- **perf**: æ€§èƒ½ä¼˜åŒ–
- **test**: æµ‹è¯•ç›¸å…³
- **chore**: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
- **ci**: CI/CD é…ç½®æ–‡ä»¶å’Œè„šæœ¬çš„å˜åŠ¨

### æäº¤æ¶ˆæ¯ç¤ºä¾‹
```bash
# âœ… æ­£ç¡®çš„æäº¤æ¶ˆæ¯æ ¼å¼
git commit -m "feat: æ·»åŠ è±†åŒ…å›¾åƒç”ŸæˆAPIæ¥å£"
git commit -m "fix: ä¿®å¤ä»»åŠ¡é˜Ÿåˆ—é‡å¤å¤„ç†é—®é¢˜"
git commit -m "refactor: é‡æ„AIæœåŠ¡Providerå±‚æ¶æ„"
git commit -m "docs: æ›´æ–°APIæ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜"
git commit -m "perf: ä¼˜åŒ–MongoDBæŸ¥è¯¢æ€§èƒ½"
git commit -m "test: æ·»åŠ AIæœåŠ¡é›†æˆæµ‹è¯•ç”¨ä¾‹"

# âŒ é¿å…çš„æäº¤æ¶ˆæ¯
git commit -m "update code"
git commit -m "fix bug"
git commit -m "add new feature"
```

### è¯¦ç»†æäº¤æ¶ˆæ¯ç¤ºä¾‹
```bash
git commit -m "feat: æ·»åŠ å³æ¢¦AIè§†é¢‘ç”ŸæˆåŠŸèƒ½

- é›†æˆç«å±±å¼•æ“Visual SDK
- æ”¯æŒæ–‡æœ¬åˆ°è§†é¢‘ç”Ÿæˆ
- æ·»åŠ è§†é¢‘ç”Ÿæˆå‚æ•°éªŒè¯
- å®ç°å¼‚æ­¥ä»»åŠ¡å¤„ç†æœºåˆ¶

Closes #123"
```

## ğŸ”„ ä»£ç å®¡æŸ¥æµç¨‹

### Pull Request æ¨¡æ¿
```markdown
## ğŸ“‹ å˜æ›´æè¿°
ç®€è¦æè¿°æœ¬æ¬¡PRçš„ä¸»è¦å˜æ›´å†…å®¹

## ğŸ¯ å˜æ›´ç±»å‹
- [ ] æ–°åŠŸèƒ½ (feat)
- [ ] Bugä¿®å¤ (fix)
- [ ] ä»£ç é‡æ„ (refactor)
- [ ] æ€§èƒ½ä¼˜åŒ– (perf)
- [ ] æ–‡æ¡£æ›´æ–° (docs)
- [ ] æµ‹è¯•ç›¸å…³ (test)

## ğŸ§ª æµ‹è¯•æƒ…å†µ
- [ ] å•å…ƒæµ‹è¯•å·²é€šè¿‡
- [ ] é›†æˆæµ‹è¯•å·²é€šè¿‡
- [ ] æ‰‹åŠ¨æµ‹è¯•å·²å®Œæˆ

## ğŸ“ æ£€æŸ¥æ¸…å•
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®ç¼–ç è§„èŒƒ
- [ ] å·²æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£
- [ ] å·²å¤„ç†æ‰€æœ‰TODOå’ŒFIXME
- [ ] å·²æ›´æ–°ç›¸å…³é…ç½®æ–‡ä»¶
- [ ] å·²è€ƒè™‘å‘åå…¼å®¹æ€§

## ğŸ”— ç›¸å…³Issue
Closes #issue_number
```

### ä»£ç å®¡æŸ¥è¦ç‚¹
1. **æ¶æ„è®¾è®¡**: æ˜¯å¦ç¬¦åˆåˆ†å±‚æ¶æ„åŸåˆ™
2. **é”™è¯¯å¤„ç†**: æ˜¯å¦æ­£ç¡®å¤„ç†å’Œä¼ æ’­é”™è¯¯
3. **æ€§èƒ½è€ƒè™‘**: æ˜¯å¦å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ
4. **å®‰å…¨æ€§**: æ˜¯å¦å­˜åœ¨å®‰å…¨éšæ‚£
5. **æµ‹è¯•è¦†ç›–**: æ˜¯å¦æœ‰è¶³å¤Ÿçš„æµ‹è¯•è¦†ç›–
6. **æ–‡æ¡£å®Œæ•´**: æ˜¯å¦æœ‰å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£

## ğŸ› ï¸ å¼€å‘å·¥å…·é…ç½®

### Makefile å¸¸ç”¨å‘½ä»¤
å‚è€ƒé¡¹ç›®æ ¹ç›®å½•çš„ [Makefile](mdc:Makefile)ï¼š

```bash
# å¼€å‘ç›¸å…³
make dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
make test         # è¿è¡Œæµ‹è¯•
make test-cover   # è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
make lint         # ä»£ç æ£€æŸ¥
make fmt          # ä»£ç æ ¼å¼åŒ–

# æ„å»ºç›¸å…³
make build        # æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶
make docker-build # æ„å»ºDockeré•œåƒ
make docker-run   # è¿è¡ŒDockerå®¹å™¨

# éƒ¨ç½²ç›¸å…³
make deploy-dev   # éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ
make deploy-prod  # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
```

### Air çƒ­é‡è½½é…ç½®
- APIæœåŠ¡å™¨: [.air.toml](mdc:.air.toml)
- é˜Ÿåˆ—å·¥ä½œå™¨: [.air.worker.toml](mdc:.air.worker.toml)

### VS Code æ¨èé…ç½®
```json
{
  "go.lintTool": "golangci-lint",
  "go.formatTool": "goimports",
  "go.useLanguageServer": true,
  "go.testFlags": ["-v", "-race"],
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.organizeImports": true
  }
}
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•åˆ†å±‚
```
â”œâ”€â”€ å•å…ƒæµ‹è¯• (Unit Tests)
â”‚   â”œâ”€â”€ Serviceå±‚æµ‹è¯•
â”‚   â”œâ”€â”€ Repositoryå±‚æµ‹è¯•
â”‚   â””â”€â”€ Utilå‡½æ•°æµ‹è¯•
â”œâ”€â”€ é›†æˆæµ‹è¯• (Integration Tests)
â”‚   â”œâ”€â”€ APIæ¥å£æµ‹è¯•
â”‚   â”œâ”€â”€ æ•°æ®åº“é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ AIæœåŠ¡é›†æˆæµ‹è¯•
â””â”€â”€ ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests)
    â””â”€â”€ å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•
```

### æµ‹è¯•å‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test ./...

# è¿è¡Œç‰¹å®šåŒ…çš„æµ‹è¯•
go test ./internal/service/...

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out

# è¿è¡ŒåŸºå‡†æµ‹è¯•
go test -bench=. ./...
```

## ğŸš€ éƒ¨ç½²æµç¨‹

### ç¯å¢ƒé…ç½®
- **å¼€å‘ç¯å¢ƒ**: ç”¨äºæ—¥å¸¸å¼€å‘å’Œæµ‹è¯•
- **é¢„å‘å¸ƒç¯å¢ƒ**: ç”¨äºå‘å¸ƒå‰çš„æœ€ç»ˆéªŒè¯
- **ç”Ÿäº§ç¯å¢ƒ**: æ­£å¼å¯¹å¤–æä¾›æœåŠ¡

### Docker éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t volcengine-go-server:latest .

# è¿è¡Œå®¹å™¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f server
docker-compose logs -f worker
```

### å¥åº·æ£€æŸ¥
```bash
# APIæœåŠ¡å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# é˜Ÿåˆ—çŠ¶æ€æ£€æŸ¥
curl http://localhost:8080/admin/queue/stats
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—ç®¡ç†
- æ—¥å¿—æ–‡ä»¶ä½ç½®: `logs/` ç›®å½•
- æ—¥å¿—è½®è½¬: æ¯æ—¥è‡ªåŠ¨è½®è½¬
- æ—¥å¿—ä¿ç•™: é»˜è®¤ä¿ç•™7å¤©
- æ—¥å¿—çº§åˆ«: é€šè¿‡ `LOG_LEVEL` ç¯å¢ƒå˜é‡é…ç½®

### æ€§èƒ½ç›‘æ§
```go
// åœ¨å…³é”®è·¯å¾„æ·»åŠ æ€§èƒ½ç›‘æ§
func (s *TaskService) CreateTask(ctx context.Context, req CreateTaskRequest) (*Task, error) {
    start := time.Now()
    defer func() {
        duration := time.Since(start)
        s.logger.WithFields(logrus.Fields{
            "operation": "create_task",
            "duration_ms": duration.Milliseconds(),
        }).Info("ä»»åŠ¡åˆ›å»ºå®Œæˆ")
    }()
    
    // ä¸šåŠ¡é€»è¾‘...
}
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜æ’æŸ¥
1. **æœåŠ¡å¯åŠ¨å¤±è´¥**: æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®å’Œä¾èµ–æœåŠ¡çŠ¶æ€
2. **AIæœåŠ¡è°ƒç”¨å¤±è´¥**: æ£€æŸ¥APIå¯†é’¥å’Œç½‘ç»œè¿æ¥
3. **ä»»åŠ¡é˜Ÿåˆ—é˜»å¡**: æ£€æŸ¥Redisè¿æ¥å’Œé˜Ÿåˆ—çŠ¶æ€
4. **æ•°æ®åº“è¿æ¥é—®é¢˜**: æ£€æŸ¥MongoDBè¿æ¥å­—ç¬¦ä¸²å’Œæƒé™

### è°ƒè¯•å·¥å…·
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
make status

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/app.log

# æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€
redis-cli -h localhost -p 6379 keys "asynq:*"
```
