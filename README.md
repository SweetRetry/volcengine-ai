# ğŸš€ Volcengine AI Server

åŸºäºç«å±±æ–¹èˆŸçš„ä¼ä¸šçº§AIæœåŠ¡å¹³å°ï¼Œé‡‡ç”¨ç°ä»£åŒ–å¾®æœåŠ¡æ¶æ„ï¼Œæ”¯æŒå¤šAIæœåŠ¡å•†ã€å¼‚æ­¥ä»»åŠ¡å¤„ç†å’Œé«˜å¹¶å‘åœºæ™¯ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ”¥ ç«å±±æ–¹èˆŸé›†æˆ
- **åŸç”Ÿæ”¯æŒ** ç«å±±å¼•æ“è±†åŒ…ç³»åˆ—æ¨¡å‹
- **å›¾åƒç”Ÿæˆ** åŸºäº `doubao-seedream-3.0-t2i` æ¨¡å‹
- **æ–‡æœ¬ç”Ÿæˆ** æ”¯æŒ `doubao-pro-4k` æ¨¡å‹  
- **è§†é¢‘ç”Ÿæˆ** é›†æˆ `doubao-video-pro` æ¨¡å‹
- **é«˜æ€§èƒ½** ç›´æ¥è°ƒç”¨ç«å±±æ–¹èˆŸAPIï¼Œæ— ä¸­é—´å±‚æŸè€—

### âš¡ Redis å¼‚æ­¥é˜Ÿåˆ—ç³»ç»Ÿ
- **é«˜å¹¶å‘å¤„ç†** åŸºäº [Asynq](https://github.com/hibiken/asynq) çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—
- **ä¼˜å…ˆçº§é˜Ÿåˆ—** æ”¯æŒ criticalã€defaultã€low ä¸‰çº§ä¼˜å…ˆçº§
- **ä»»åŠ¡é‡è¯•** è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿ä»»åŠ¡å¯é æ‰§è¡Œ
- **å®æ—¶ç›‘æ§** é˜Ÿåˆ—çŠ¶æ€å®æ—¶ç›‘æ§å’Œç®¡ç†
- **æ°´å¹³æ‰©å±•** æ”¯æŒå¤šworkerèŠ‚ç‚¹åˆ†å¸ƒå¼å¤„ç†

### ğŸ—ï¸ æœåŠ¡å•†æ³¨å†Œè€…æ¨¡å¼
- **æ’ä»¶åŒ–æ¶æ„** æ”¯æŒå¤šAIæœåŠ¡å•†åŠ¨æ€æ³¨å†Œ
- **ç»Ÿä¸€æ¥å£** æ ‡å‡†åŒ–çš„AIæœåŠ¡æä¾›å•†æ¥å£
- **çƒ­æ’æ‹”** è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ /ç§»é™¤æœåŠ¡å•†
- **è´Ÿè½½å‡è¡¡** æ™ºèƒ½è·¯ç”±åˆ°æœ€ä¼˜æœåŠ¡å•†
- **å®¹é”™æœºåˆ¶** æœåŠ¡å•†æ•…éšœè‡ªåŠ¨åˆ‡æ¢

### ğŸ”„ åŒæ­¥/å¼‚æ­¥åŒæ¨¡å¼
- **åŒæ­¥æ¨¡å¼** é€‚ç”¨äºå®æ—¶äº¤äº’åœºæ™¯
- **å¼‚æ­¥æ¨¡å¼** é€‚ç”¨äºæ‰¹é‡å¤„ç†å’Œé•¿æ—¶é—´ä»»åŠ¡
- **çµæ´»åˆ‡æ¢** æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªç”±é€‰æ‹©å¤„ç†æ¨¡å¼
- **çŠ¶æ€è¿½è¸ª** å¼‚æ­¥ä»»åŠ¡å…¨ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ç®¡ç†

## ğŸ›ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Client    â”‚    â”‚   Mobile App    â”‚    â”‚   Third Party   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      API Gateway         â”‚
                    â”‚    (Gin Framework)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Service Registry       â”‚
                    â”‚  (Provider Pattern)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Volcengine AI  â”‚    â”‚    Redis Queue       â”‚    â”‚   MongoDB       â”‚
â”‚   Provider     â”‚    â”‚   (Asynq Worker)     â”‚    â”‚   Database      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æ ¸å¿ƒ
- **Go 1.21+** - é«˜æ€§èƒ½åç«¯è¯­è¨€
- **Gin** - è½»é‡çº§Webæ¡†æ¶
- **MongoDB** - æ–‡æ¡£æ•°æ®åº“
- **Redis** - ç¼“å­˜å’Œé˜Ÿåˆ—å­˜å‚¨

### AIæœåŠ¡é›†æˆ
- **ç«å±±æ–¹èˆŸSDK** - å®˜æ–¹Go SDK
- **å¤šæ¨¡å‹æ”¯æŒ** - å›¾åƒã€æ–‡æœ¬ã€è§†é¢‘ç”Ÿæˆ

### é˜Ÿåˆ—ç³»ç»Ÿ
- **Asynq** - åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—
- **Redis Streams** - æ¶ˆæ¯æµå¤„ç†
- **Worker Pool** - å¹¶å‘ä»»åŠ¡å¤„ç†

### ç›‘æ§è¿ç»´
- **Logrus** - ç»“æ„åŒ–æ—¥å¿—
- **Prometheus** - æŒ‡æ ‡ç›‘æ§ï¼ˆè§„åˆ’ä¸­ï¼‰
- **Docker** - å®¹å™¨åŒ–éƒ¨ç½²

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Go 1.21+
- MongoDB 4.4+
- Redis 6.0+
- ç«å±±æ–¹èˆŸAPIå¯†é’¥ (ARK_API_KEY)

### å®‰è£…éƒ¨ç½²

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/your-org/volcengine-go-server.git
cd volcengine-go-server
```

2. **å®‰è£…ä¾èµ–**
```bash
go mod download
```

3. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å…³é”®å‚æ•°ï¼š
# PORT=8080
# ENVIRONMENT=development
# MONGO_URL=mongodb://localhost:27017/xxx
# REDIS_URL=redis://localhost:6379
# ARK_API_KEY=your_ark_api_key_here
# AI_TIMEOUT=30s
```

4. **å¯åŠ¨æœåŠ¡**
```bash
# å¯åŠ¨APIæœåŠ¡å™¨
go run cmd/server/main.go

# å¯åŠ¨é˜Ÿåˆ—å·¥ä½œå™¨
go run cmd/worker/main.go
```

### Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t volcengine-ai-server .

# ä½¿ç”¨ Docker Compose å¯åŠ¨å®Œæ•´ç¯å¢ƒ
docker-compose up -d
```

## ğŸ“– API æ–‡æ¡£

### å›¾åƒç”Ÿæˆ

#### å¼‚æ­¥ç”Ÿæˆï¼ˆæ¨èï¼‰
```bash
# åˆ›å»ºå›¾åƒç”Ÿæˆä»»åŠ¡
curl -X POST http://localhost:8080/ai/image/task \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "ä¸€åªå¯çˆ±çš„å°çŒ«å’ªåœ¨èŠ±å›­é‡Œç©è€",
    "user_id": "user123",
    "provider": "volcengine",
    "model": "doubao-seedream-3.0-t2i",
    "size": "1024x1024"
  }'

# æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
curl http://localhost:8080/ai/image/result/{task_id}
```

### ä»»åŠ¡ç®¡ç†

```bash
# è·å–ç”¨æˆ·ä»»åŠ¡åˆ—è¡¨
curl "http://localhost:8080/ai/image/tasks?user_id=user123&limit=10"

# åˆ é™¤ä»»åŠ¡
curl -X DELETE http://localhost:8080/ai/image/task/{task_id}
```

## ğŸ”§ é…ç½®è¯´æ˜

### æœåŠ¡å•†é…ç½®
```go
// æ³¨å†Œç«å±±å¼•æ“æœåŠ¡å•†
arkAPIKey := os.Getenv("ARK_API_KEY")
registry := queue.NewServiceRegistry()
volcengineProvider := service.NewVolcengineAIProvider(
    volcengineService,
    imageTaskService,
)
registry.RegisterProvider(volcengineProvider)
```

### é˜Ÿåˆ—é…ç½®
```go
// Redisé˜Ÿåˆ—é…ç½®
redisURL := os.Getenv("REDIS_URL")
queue := queue.NewRedisQueue(
    redisURL,
    imageTaskService,
    serviceRegistry,
)

// å¯åŠ¨å·¥ä½œå™¨
go queue.StartWorker(ctx)
```

### æ•°æ®åº“é…ç½®
```go
// MongoDBè¿æ¥
mongoURL := os.Getenv("MONGO_URL")
db, err := database.NewMongoDB(mongoURL)
if err != nil {
    log.Fatal("æ•°æ®åº“è¿æ¥å¤±è´¥:", err)
}
```

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

### å¹¶å‘å¤„ç†èƒ½åŠ›
- **é˜Ÿåˆ—å¹¶å‘åº¦**: 10ä¸ªworkerï¼ˆå¯é…ç½®ï¼‰
- **APIå¹¶å‘**: æ”¯æŒæ•°åƒå¹¶å‘è¯·æ±‚
- **ä»»åŠ¡åå**: æ¯ç§’å¤„ç†100+å›¾åƒç”Ÿæˆä»»åŠ¡

### å¯æ‰©å±•æ€§
- **æ°´å¹³æ‰©å±•**: æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²
- **é˜Ÿåˆ—åˆ†ç‰‡**: Redisé›†ç¾¤æ”¯æŒ
- **æ•°æ®åº“åˆ†ç‰‡**: MongoDBåˆ†ç‰‡é›†ç¾¤

### å¯é æ€§ä¿éšœ
- **ä»»åŠ¡é‡è¯•**: è‡ªåŠ¨é‡è¯•å¤±è´¥ä»»åŠ¡
- **æ•°æ®æŒä¹…åŒ–**: MongoDB + RedisæŒä¹…åŒ–
- **æœåŠ¡é™çº§**: æœåŠ¡å•†æ•…éšœè‡ªåŠ¨åˆ‡æ¢

## ğŸ” ç›‘æ§è¿ç»´

### é˜Ÿåˆ—ç›‘æ§
```bash
# æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€
./scripts/check_queue_status.sh

# æ¸…ç†é˜Ÿåˆ—
./scripts/clear_redis_queue.sh
```

### æ€§èƒ½æµ‹è¯•
```bash
# å…¨é“¾è·¯æµ‹è¯•
./scripts/test_volcengine_full.sh

# å‹åŠ›æµ‹è¯•
./scripts/load_test.sh
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# å®æ—¶æ—¥å¿—
tail -f logs/app.log

# é”™è¯¯æ—¥å¿—
grep "ERROR" logs/app.log
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'feat: æ·»åŠ æŸä¸ªç‰¹æ€§'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ Pull Request

### æäº¤è§„èŒƒ
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ™ è‡´è°¢

- [ç«å±±æ–¹èˆŸ](https://www.volcengine.com/product/ark) - æä¾›å¼ºå¤§çš„AIèƒ½åŠ›
- [Asynq](https://github.com/hibiken/asynq) - ä¼˜ç§€çš„Goä»»åŠ¡é˜Ÿåˆ—åº“
- [Gin](https://github.com/gin-gonic/gin) - é«˜æ€§èƒ½Webæ¡†æ¶
- [MongoDB](https://www.mongodb.com/) - çµæ´»çš„æ–‡æ¡£æ•°æ®åº“

## ğŸ“ è”ç³»æˆ‘ä»¬

- é¡¹ç›®ä¸»é¡µ: [GitHub Repository](https://github.com/your-org/volcengine-go-server)
- é—®é¢˜åé¦ˆ: [Issues](https://github.com/your-org/volcengine-go-server/issues)
- é‚®ç®±: your-email@example.com

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªæ˜Ÿæ ‡ï¼ 