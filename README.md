# ğŸš€ Volcengine AI Server

åŸºäºç«å±±æ–¹èˆŸçš„ä¼ä¸šçº§AIæœåŠ¡å¹³å°ï¼Œé‡‡ç”¨ç°ä»£åŒ–åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šAIæœåŠ¡å•†ã€å¼‚æ­¥ä»»åŠ¡å¤„ç†å’Œé«˜å¹¶å‘åœºæ™¯ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ—ï¸ ç°ä»£åŒ–åˆ†å±‚æ¶æ„

- **Coreå±‚** - æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ŒåŒ…å«ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿå’ŒAIä»»åŠ¡åˆ†å‘å™¨æ¥å£
- **Providerå±‚** - ä»»åŠ¡åˆ†å‘å±‚ï¼Œæ ¹æ®æ¨¡å‹å‚æ•°æ™ºèƒ½è·¯ç”±åˆ°å…·ä½“Service
- **Serviceå±‚** - ä¸šåŠ¡å®ç°å±‚ï¼ŒåŒ…å«çœŸå®çš„AI APIè°ƒç”¨é€»è¾‘
- **Repositoryå±‚** - æ•°æ®è®¿é—®å±‚ï¼Œç»Ÿä¸€çš„æ•°æ®åº“æ“ä½œæ¥å£
- **èŒè´£åˆ†ç¦»** - æ¯å±‚èŒè´£æ˜ç¡®ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•

### ğŸ”¥ ç«å±±æ–¹èˆŸå¤šæ¨¡å‹é›†æˆ

- **è±†åŒ…å›¾åƒç”Ÿæˆ** åŸºäº `doubao-seedream-3-0-t2i-250415` æ¨¡å‹ï¼Œæ”¯æŒé«˜è´¨é‡å›¾åƒç”Ÿæˆ
- **å³æ¢¦AIå›¾åƒç”Ÿæˆ** é›†æˆ `jimeng_high_aes_general_v21_L` æ¨¡å‹ï¼Œä¸“ä¸šçº§è‰ºæœ¯åˆ›ä½œ
- **å³æ¢¦AIè§†é¢‘ç”Ÿæˆ** åŸºäº `jimeng_vgfm_t2v_l20` æ¨¡å‹ï¼Œæ”¯æŒæ–‡æœ¬åˆ°è§†é¢‘ç”Ÿæˆ
- **æ™ºèƒ½æ¨¡å‹è·¯ç”±** Providerå±‚æ ¹æ®ä¸åŒæ¨¡å‹è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å¤„ç†ç­–ç•¥
- **å¤šæ ¼å¼æ”¯æŒ** æ”¯æŒURLå’ŒBase64ä¸¤ç§å›¾ç‰‡è¿”å›æ ¼å¼
- **å°ºå¯¸ä¼˜åŒ–** é’ˆå¯¹å³æ¢¦AIå®˜æ–¹å»ºè®®çš„æœ€ä½³å°ºå¯¸é…ç½®è¿›è¡Œä¼˜åŒ–

### âš¡ æ ¸å¿ƒåŸºç¡€è®¾æ–½ (Core)

- **ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿ** åŸºäº [Asynq](https://github.com/hibiken/asynq) çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—
- **AIä»»åŠ¡åˆ†å‘å™¨** ç»Ÿä¸€çš„ä»»åŠ¡åˆ†å‘æ¥å£ï¼Œæ”¯æŒæ’ä»¶åŒ–æ‰©å±•
- **æœåŠ¡æ³¨å†Œå™¨** åŠ¨æ€æ³¨å†Œå’Œç®¡ç†AIæœåŠ¡æä¾›å•†
- **ä¼˜å…ˆçº§é˜Ÿåˆ—** æ”¯æŒ criticalã€defaultã€low ä¸‰çº§ä¼˜å…ˆçº§
- **ä»»åŠ¡é‡è¯•** è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿ä»»åŠ¡å¯é æ‰§è¡Œ
- **å®æ—¶ç›‘æ§** é˜Ÿåˆ—çŠ¶æ€å®æ—¶ç›‘æ§å’Œç®¡ç†

### ğŸ¯ Provider-Service åˆ†å±‚æ¨¡å¼

- **Providerå±‚èŒè´£** - ä»»åŠ¡åˆ†å‘å’Œè·¯ç”±ï¼Œæ ¹æ®æ¨¡å‹å‚æ•°å†³å®šè°ƒç”¨å“ªä¸ªServiceæ–¹æ³•
- **Serviceå±‚èŒè´£** - å…·ä½“çš„AI APIè°ƒç”¨å’Œä¸šåŠ¡é€»è¾‘å®ç°
- **æ¥å£è§£è€¦** - Provideråªä¾èµ–Serviceæ¥å£ï¼Œå®Œå…¨è§£è€¦
- **çƒ­æ’æ‹”** - è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ /ç§»é™¤æœåŠ¡å•†
- **å®¹é”™æœºåˆ¶** - æœåŠ¡å•†æ•…éšœè‡ªåŠ¨åˆ‡æ¢

### ğŸ“ æ™ºèƒ½æ—¥å¿—ç®¡ç†ç³»ç»Ÿ

- **åŒè¾“å‡ºæ¨¡å¼** åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæœ¬åœ°æ–‡ä»¶ï¼Œæ”¯æŒå®æ—¶æŸ¥çœ‹å’ŒæŒä¹…åŒ–å­˜å‚¨
- **è‡ªåŠ¨æ—¥å¿—è½®è½¬** æŒ‰æ—¥æœŸè‡ªåŠ¨åˆ›å»ºæ–°æ—¥å¿—æ–‡ä»¶ï¼Œæ¯å¤©åˆå¤œè‡ªåŠ¨åˆ‡æ¢
- **æ™ºèƒ½æ¸…ç†æœºåˆ¶** è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ—¥å¿—æ–‡ä»¶ï¼Œå¯é…ç½®ä¿ç•™å¤©æ•°ï¼ˆé»˜è®¤7å¤©ï¼‰
- **ç»“æ„åŒ–æ—¥å¿—** é‡‡ç”¨JSONæ ¼å¼ï¼ŒåŒ…å«æ—¶é—´æˆ³ã€çº§åˆ«ã€æ¶ˆæ¯å’Œç»“æ„åŒ–å­—æ®µ
- **çµæ´»é…ç½®** æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡é…ç½®æ—¥å¿—çº§åˆ«å’Œä¿ç•™ç­–ç•¥

### ğŸ”„ ç»Ÿä¸€ä»»åŠ¡ç®¡ç†

- **ç»Ÿä¸€Taskæ¨¡å‹** ä¸€ä¸ªæ¨¡å‹å¤„ç†æ‰€æœ‰ç±»å‹ä»»åŠ¡ï¼ˆå›¾åƒã€è§†é¢‘ã€æ–‡æœ¬ï¼‰
- **ç»Ÿä¸€TaskService** ä¸€ä¸ªæœåŠ¡å¤„ç†æ‰€æœ‰ä»»åŠ¡æ“ä½œ
- **æç®€APIè®¾è®¡** æ€»å…±åªæœ‰6ä¸ªAPIæ¥å£ï¼ˆ3ä¸ªåˆ›å»º + 3ä¸ªç»Ÿä¸€ï¼‰
- **çº¿æ€§æ‰©å±•** APIæ•°é‡éšä»»åŠ¡ç±»å‹çº¿æ€§å¢é•¿ï¼ˆN+3ï¼‰ï¼Œè€Œéä¼ ç»Ÿçš„å¹³æ–¹å¢é•¿ï¼ˆNÃ—4ï¼‰
- **çŠ¶æ€è¿½è¸ª** å¼‚æ­¥ä»»åŠ¡å…¨ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ç®¡ç†
- **åˆ†é¡µæŸ¥è¯¢** æ”¯æŒç”¨æˆ·ä»»åŠ¡åˆ—è¡¨åˆ†é¡µæŸ¥è¯¢

## ğŸ›ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Client    â”‚    â”‚   Mobile App    â”‚    â”‚   Third Party   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      API Gateway         â”‚
                    â”‚    (Gin Framework)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     AI Handler           â”‚
                    â”‚   (Unified Router)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Core Layer     â”‚    â”‚   Provider Layer     â”‚    â”‚  Service Layer  â”‚
â”‚ â”œâ”€TaskQueue    â”‚    â”‚ â”œâ”€VolcengineProvider â”‚    â”‚ â”œâ”€VolcengineServiceâ”‚
â”‚ â”œâ”€Dispatcher   â”‚    â”‚ â””â”€OpenAIProvider     â”‚    â”‚ â””â”€OpenAIService  â”‚
â”‚ â””â”€Registry     â”‚    â”‚                      â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                         â”‚                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Redis       â”‚              â”‚     MongoDB       â”‚    â”‚   Repository    â”‚
â”‚   (Queue)      â”‚              â”‚   (Database)      â”‚    â”‚     Layer       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„å±‚æ¬¡è¯´æ˜

#### Core Layer (æ ¸å¿ƒåŸºç¡€è®¾æ–½å±‚)

- **TaskQueue** - ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿï¼Œå¤„ç†å¼‚æ­¥ä»»åŠ¡è°ƒåº¦
- **AITaskDispatcher** - AIä»»åŠ¡åˆ†å‘å™¨æ¥å£å®šä¹‰
- **ServiceRegistry** - æœåŠ¡æ³¨å†Œå™¨ï¼Œç®¡ç†Providerå®ä¾‹

#### Provider Layer (ä»»åŠ¡åˆ†å‘å±‚)

- **VolcengineProvider** - ç«å±±å¼•æ“ä»»åŠ¡åˆ†å‘å™¨
- **OpenAIProvider** - OpenAIä»»åŠ¡åˆ†å‘å™¨
- **èŒè´£** - æ ¹æ®æ¨¡å‹å‚æ•°å†³å®šè°ƒç”¨å“ªä¸ªServiceæ–¹æ³•

#### Service Layer (ä¸šåŠ¡å®ç°å±‚)

- **VolcengineService** - ç«å±±å¼•æ“APIå…·ä½“å®ç°
- **OpenAIService** - OpenAI APIå…·ä½“å®ç°
- **TaskService** - ç»Ÿä¸€ä»»åŠ¡ç®¡ç†æœåŠ¡
- **èŒè´£** - çœŸå®çš„AI APIè°ƒç”¨å’Œä¸šåŠ¡é€»è¾‘

#### Repository Layer (æ•°æ®è®¿é—®å±‚)

- **MongoDB** - ä»»åŠ¡æ•°æ®æŒä¹…åŒ–
- **ç»Ÿä¸€æ¥å£** - æ ‡å‡†åŒ–æ•°æ®è®¿é—®æ“ä½œ

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æ ¸å¿ƒ

- **Go 1.21+** - é«˜æ€§èƒ½åç«¯è¯­è¨€
- **Gin** - è½»é‡çº§Webæ¡†æ¶
- **MongoDB** - æ–‡æ¡£æ•°æ®åº“
- **Redis** - ç¼“å­˜å’Œé˜Ÿåˆ—å­˜å‚¨

### AIæœåŠ¡é›†æˆ

- **ç«å±±æ–¹èˆŸSDK** - å®˜æ–¹Go SDK
- **ç«å±±å¼•æ“Visual SDK** - å³æ¢¦AIä¸“ç”¨SDK
- **å¤šæ¨¡å‹æ”¯æŒ** - è±†åŒ…ã€å³æ¢¦AIå›¾åƒç”Ÿæˆ

### æ ¸å¿ƒåŸºç¡€è®¾æ–½

- **Asynq** - åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—
- **Redis Backend** - é˜Ÿåˆ—æ•°æ®å­˜å‚¨å’ŒæŒä¹…åŒ–
- **Worker Pool** - å¹¶å‘ä»»åŠ¡å¤„ç†

### ç›‘æ§è¿ç»´

- **Logrus** - ç»“æ„åŒ–æ—¥å¿—
- **æ—¥å¿—ç®¡ç†å™¨** - è‡ªåŠ¨è½®è½¬å’Œæ¸…ç†
- **å‚æ•°éªŒè¯** - Gin binding + validator
- **é”™è¯¯å¤„ç†** - ç»Ÿä¸€é”™è¯¯å“åº”æœºåˆ¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.21+
- MongoDB 4.4+
- Redis 6.0+
- ç«å±±æ–¹èˆŸAPIå¯†é’¥ (ARK_API_KEY)
- ç«å±±å¼•æ“Access Key (å¯é€‰ï¼Œç”¨äºå³æ¢¦AI)

### å®‰è£…éƒ¨ç½²

1. **å…‹éš†é¡¹ç›®**

```bash
git clone https://github.com/your-org/volcengine-go-server.git
cd volcengine-go-server
```

2. **å®‰è£…ä¾èµ–**

```bash
go mod download
```

3. **é…ç½®ç¯å¢ƒå˜é‡**

```bash
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å…³é”®å‚æ•°ï¼š
# PORT=8080
# ENVIRONMENT=development
# MONGO_URL=mongodb://localhost:27017/volcengine_db
# REDIS_URL=redis://localhost:6379
# ARK_API_KEY=your_ark_api_key_here
# VOLCENGINE_ACCESS_KEY=your_access_key (å¯é€‰)
# VOLCENGINE_SECRET_KEY=your_secret_key (å¯é€‰)
# AI_TIMEOUT=30s
# LOG_LEVEL=info
# LOG_KEEP_DAYS=7
```

4. **å¯åŠ¨æœåŠ¡**

```bash
# å¯åŠ¨APIæœåŠ¡å™¨
make run
# æˆ–è€…
go run cmd/server/main.go

# å¯åŠ¨é˜Ÿåˆ—å·¥ä½œå™¨ï¼ˆä»»åŠ¡å¤„ç†ä¸­å¿ƒï¼‰
make run-worker
# æˆ–è€…
go run cmd/worker/main.go

# æ„å»ºæ‰€æœ‰æœåŠ¡
make build-all

# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help
```

### å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰

å®‰è£…Airå·¥å…·ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰ï¼š

```bash
go install github.com/cosmtrek/air@latest
```

å¯åŠ¨å¼€å‘æ¨¡å¼ï¼š

```bash
# å¼€å‘æ¨¡å¼è¿è¡ŒAPIæœåŠ¡å™¨ï¼ˆçƒ­é‡è½½ï¼‰
make dev

# å¼€å‘æ¨¡å¼è¿è¡ŒWorkeræœåŠ¡ï¼ˆçƒ­é‡è½½ï¼‰
make dev-worker

# æŸ¥çœ‹å¦‚ä½•åŒæ—¶è¿è¡Œä¸¤ä¸ªæœåŠ¡
make dev-all
```

åœ¨ä¸åŒç»ˆç«¯çª—å£ä¸­åŒæ—¶è¿è¡Œä¸¤ä¸ªæœåŠ¡ï¼š

```bash
# ç»ˆç«¯1 - APIæœåŠ¡å™¨
make dev

# ç»ˆç«¯2 - WorkeræœåŠ¡  
make dev-worker
```

### å¿«é€Ÿå¼€å‘å¯åŠ¨

ä½¿ç”¨æä¾›çš„å¼€å‘å¯åŠ¨è„šæœ¬ï¼š

```bash
# è¿è¡Œäº¤äº’å¼å¼€å‘å¯åŠ¨è„šæœ¬
./scripts/dev-start.sh
```

è¯¥è„šæœ¬ä¼šï¼š

- è‡ªåŠ¨æ£€æŸ¥å¹¶å®‰è£…Airå·¥å…·
- æ£€æŸ¥å¹¶åˆ›å»º.envé…ç½®æ–‡ä»¶
- æä¾›äº¤äº’å¼èœå•é€‰æ‹©å¯åŠ¨æ¨¡å¼

## ğŸ“– API æ–‡æ¡£

### âš ï¸ é‡è¦è¯´æ˜

**modelå’Œproviderå­—æ®µä¸ºå¿…å¡«å‚æ•°**ï¼šæ‰€æœ‰ä»»åŠ¡åˆ›å»ºæ¥å£éƒ½è¦æ±‚æ˜ç¡®æŒ‡å®š`model`å’Œ`provider`å­—æ®µï¼Œä¸å†æä¾›é»˜è®¤å€¼ã€‚è¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯ï¼š
- ç¡®ä¿ç”¨æˆ·æ˜ç¡®çŸ¥é“ä½¿ç”¨çš„æ˜¯å“ªä¸ªAIæ¨¡å‹å’ŒæœåŠ¡æä¾›å•†
- é¿å…å› é»˜è®¤å€¼å˜æ›´å¯¼è‡´çš„æ„å¤–ç»“æœ
- æé«˜APIçš„æ˜ç¡®æ€§å’Œå¯é¢„æµ‹æ€§
- ç®€åŒ–ä»£ç é€»è¾‘ï¼Œå‡å°‘é…ç½®å¤æ‚åº¦

### ğŸ¯ ç»Ÿä¸€APIè®¾è®¡

æœ¬ç³»ç»Ÿé‡‡ç”¨ç»Ÿä¸€çš„APIè®¾è®¡æ¨¡å¼ï¼Œæ‰€æœ‰AIä»»åŠ¡éƒ½éµå¾ªç›¸åŒçš„è¯·æ±‚ç»“æ„å’Œå“åº”æ ¼å¼ï¼š

#### ä»»åŠ¡åˆ›å»ºæ¥å£

```bash
# å›¾åƒç”Ÿæˆä»»åŠ¡
POST /api/v1/ai/image/task

# è§†é¢‘ç”Ÿæˆä»»åŠ¡  
POST /api/v1/ai/video/task

# æ–‡æœ¬ç”Ÿæˆä»»åŠ¡
POST /api/v1/ai/text/task
```

#### ç»Ÿä¸€è¯·æ±‚ç»“æ„

```json
{
  "prompt": "ä»»åŠ¡æè¿°æ–‡æœ¬",
  "user_id": "ç”¨æˆ·ID",
  "provider": "æœåŠ¡æä¾›å•†åç§°",
  "model": "å…·ä½“æ¨¡å‹åç§°",
  
  // å¯é€‰å‚æ•°ï¼ˆæ ¹æ®ä»»åŠ¡ç±»å‹ï¼‰
  "size": "å›¾åƒå°ºå¯¸",
  "aspect_ratio": "è§†é¢‘æ¯”ä¾‹", 
  "max_tokens": 1000,
  "temperature": 0.7,
  "seed": -1
}
```

#### ç»Ÿä¸€å“åº”ç»“æ„

```json
{
  "success": true,
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "status": "pending",
    "provider": "æœåŠ¡æä¾›å•†",
    "model": "æ¨¡å‹åç§°"
  },
  "message": "ä»»åŠ¡åˆ›å»ºæˆåŠŸ"
}
```

### ğŸ”„ ç»Ÿä¸€ä»»åŠ¡ç®¡ç†

```bash
# æŸ¥è¯¢ä»»åŠ¡ç»“æœï¼ˆæ”¯æŒæ‰€æœ‰ä»»åŠ¡ç±»å‹ï¼‰
GET /api/v1/ai/task/result/{task_id}

# åˆ é™¤ä»»åŠ¡ï¼ˆæ”¯æŒæ‰€æœ‰ä»»åŠ¡ç±»å‹ï¼‰
DELETE /api/v1/ai/task/{task_id}

# è·å–ç”¨æˆ·ä»»åŠ¡åˆ—è¡¨ï¼ˆæ”¯æŒç±»å‹è¿‡æ»¤ï¼‰
GET /api/v1/ai/tasks?user_id={user_id}&type={type}&limit={limit}&offset={offset}
```

#### ä»»åŠ¡æŸ¥è¯¢å“åº”

```json
{
  "success": true,
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "type": "image|video|text",
    "status": "pending|processing|completed|failed",
    "created": "åˆ›å»ºæ—¶é—´",
    "updated": "æ›´æ–°æ—¶é—´",
    
    // ç»“æœå­—æ®µï¼ˆä»»åŠ¡å®Œæˆæ—¶ï¼‰
    "image_url": "å›¾åƒURL",
    "video_url": "è§†é¢‘URL", 
    "text_result": "æ–‡æœ¬ç»“æœ"
  },
  "message": "ä»»åŠ¡å®Œæˆ"
}
```

### ğŸ“‹ æ”¯æŒçš„æ¨¡å‹å’Œå‚æ•°

#### ç«å±±å¼•æ“æ¨¡å‹

| æ¨¡å‹ç±»å‹ | æ¨¡å‹åç§° | æ”¯æŒå‚æ•° |
|---------|---------|---------|
| è±†åŒ…å›¾åƒ | `doubao-seedream-3-0-t2i-250415` | size: 1024x1024, 864x1152, 1152x864, 1280x720, 720x1280, 832x1248, 1248x832, 1512x648 |
| å³æ¢¦AIå›¾åƒ | `jimeng_high_aes_general_v21_L` | size: 512x512, 512x384, 384x512, 512x341, 341x512, 512x288, 288x512 |
| å³æ¢¦AIè§†é¢‘ | `jimeng_vgfm_t2v_l20` | aspect_ratio: 16:9, 9:16, 1:1, 4:3, 3:4, 21:9; seed: éšæœºç§å­ |
| è±†åŒ…æ–‡æœ¬ | `doubao-pro-4k` | max_tokens: æœ€å¤§ä»¤ç‰Œæ•°; temperature: æ¸©åº¦å‚æ•° |

#### OpenAIæ¨¡å‹ï¼ˆç¤ºä¾‹æ‰©å±•ï¼‰

| æ¨¡å‹ç±»å‹ | æ¨¡å‹åç§° | æ”¯æŒå‚æ•° |
|---------|---------|---------|
| DALL-Eå›¾åƒ | `dall-e-3` | size: 1024x1024, 1024x1792, 1792x1024 |
| GPTæ–‡æœ¬ | `gpt-4` | max_tokens, temperature |
| Soraè§†é¢‘ | `sora` | aspect_ratio: 16:9, 9:16, 1:1 |

### ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

#### åˆ›å»ºå›¾åƒç”Ÿæˆä»»åŠ¡

```bash
curl -X POST http://localhost:8080/api/v1/ai/image/task \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "ä¸€åªå¯çˆ±çš„å°çŒ«å’ªåœ¨èŠ±å›­é‡Œç©è€",
    "user_id": "user123",
    "provider": "volcengine",
    "model": "doubao-seedream-3-0-t2i-250415",
    "size": "1024x1024"
  }'
```

#### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```bash
curl http://localhost:8080/api/v1/ai/task/result/task_id_here
```

#### è·å–ç”¨æˆ·ä»»åŠ¡åˆ—è¡¨

```bash
# è·å–æ‰€æœ‰ä»»åŠ¡
curl "http://localhost:8080/api/v1/ai/tasks?user_id=user123&limit=10&offset=0"

# åªè·å–å›¾åƒä»»åŠ¡
curl "http://localhost:8080/api/v1/ai/tasks?user_id=user123&type=image&limit=10&offset=0"
```

### ğŸ”§ APIè®¾è®¡ä¼˜åŠ¿

- **ç»Ÿä¸€æ¥å£** - æ‰€æœ‰ä»»åŠ¡ç±»å‹ä½¿ç”¨ç›¸åŒçš„APIæ¨¡å¼
- **çº¿æ€§æ‰©å±•** - æ–°å¢ä»»åŠ¡ç±»å‹åªéœ€æ·»åŠ ä¸€ä¸ªåˆ›å»ºæ¥å£
- **ç±»å‹æ— å…³** - æŸ¥è¯¢ã€åˆ é™¤ã€åˆ—è¡¨æ¥å£ä¸ä»»åŠ¡ç±»å‹æ— å…³
- **å‚æ•°æ˜ç¡®** - å¿…å¡«çš„modelå’Œproviderå­—æ®µç¡®ä¿è°ƒç”¨æ˜ç¡®æ€§
- **æ˜“äºé›†æˆ** - å®¢æˆ·ç«¯åªéœ€è®°ä½ç»Ÿä¸€çš„è°ƒç”¨æ¨¡å¼

## ğŸ—ï¸ æ¶æ„è®¾è®¡ç†å¿µ

### Provider-Service åˆ†å±‚æ¨¡å¼

```go
// Providerå±‚ - ä»»åŠ¡åˆ†å‘
type VolcengineProvider struct {
    volcengineService *service.VolcengineService
    taskService       *service.TaskService
}

func (p *VolcengineProvider) DispatchImageTask(ctx context.Context, taskID string, model string, input map[string]interface{}) error {
    switch model {
    case "jimeng_high_aes_general_v21_L":
        return p.volcengineService.GenerateImageByJimeng(ctx, taskID, input)
    case "doubao-seedream-3-0-t2i-250415":
        return p.volcengineService.GenerateImageByDoubao(ctx, taskID, input)
    default:
        return fmt.Errorf("ä¸æ”¯æŒçš„æ¨¡å‹: %s", model)
    }
}
```

```go
// Serviceå±‚ - å…·ä½“å®ç°
type VolcengineService struct {
    config      *config.AIConfig
    taskService *TaskService
}

func (s *VolcengineService) GenerateImageByJimeng(ctx context.Context, taskID string, input map[string]interface{}) error {
    // å…·ä½“çš„å³æ¢¦AI APIè°ƒç”¨é€»è¾‘
    // ...
}

func (s *VolcengineService) GenerateImageByDoubao(ctx context.Context, taskID string, input map[string]interface{}) error {
    // å…·ä½“çš„è±†åŒ…APIè°ƒç”¨é€»è¾‘
    // ...
}
```

### æ ¸å¿ƒåŸºç¡€è®¾æ–½

```go
// Coreå±‚ - ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿ
type TaskQueue struct {
    client          *asynq.Client
    server          *asynq.Server
    serviceRegistry *ServiceRegistry
    taskService     *service.TaskService
}

// Coreå±‚ - æœåŠ¡æ³¨å†Œå™¨
type ServiceRegistry struct {
    dispatchers map[string]AITaskDispatcher
}

func (sr *ServiceRegistry) RegisterDispatcher(dispatcher AITaskDispatcher) {
    sr.dispatchers[dispatcher.GetProviderName()] = dispatcher
}
```

### æ‰©å±•æ–°æœåŠ¡å•†

æ·»åŠ æ–°çš„AIæœåŠ¡å•†åªéœ€è¦ï¼š

1. **å®ç°Serviceå±‚**

```go
type NewAIService struct {
    apiKey      string
    taskService *TaskService
}

func (s *NewAIService) GenerateImage(ctx context.Context, taskID string, input map[string]interface{}) error {
    // æ–°æœåŠ¡å•†çš„APIè°ƒç”¨é€»è¾‘
}
```

2. **å®ç°Providerå±‚**

```go
type NewAIProvider struct {
    newAIService *NewAIService
    taskService  *TaskService
}

func (p *NewAIProvider) DispatchImageTask(ctx context.Context, taskID string, model string, input map[string]interface{}) error {
    return p.newAIService.GenerateImage(ctx, taskID, input)
}
```

3. **æ³¨å†Œåˆ°ç³»ç»Ÿ**

```go
newAIService := service.NewNewAIService(apiKey, taskService)
newAIProvider := provider.NewNewAIProvider(newAIService, taskService)
serviceRegistry.RegisterDispatcher(newAIProvider)
```

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

### æ¨¡å‹æ€§èƒ½å¯¹æ¯”

| æ¨¡å‹     | ç”Ÿæˆæ—¶é—´ | å›¾åƒè´¨é‡ | é€‚ç”¨åœºæ™¯           |
| -------- | -------- | -------- | ------------------ |
| è±†åŒ…æ¨¡å‹ | 3-5ç§’    | é«˜è´¨é‡   | é€šç”¨å›¾åƒç”Ÿæˆ       |
| å³æ¢¦AI   | 6-10ç§’   | ä¸“ä¸šçº§   | è‰ºæœ¯åˆ›ä½œã€ä¸“ä¸šè®¾è®¡ |

### å¹¶å‘å¤„ç†èƒ½åŠ›

- **é˜Ÿåˆ—å¹¶å‘åº¦**: 10ä¸ªworkerï¼ˆå¯é…ç½®ï¼‰
- **APIå¹¶å‘**: æ”¯æŒæ•°åƒå¹¶å‘è¯·æ±‚
- **ä»»åŠ¡åå**: æ¯ç§’å¤„ç†100+å›¾åƒç”Ÿæˆä»»åŠ¡

### å¯æ‰©å±•æ€§

- **æ°´å¹³æ‰©å±•**: æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²
- **é˜Ÿåˆ—åˆ†ç‰‡**: Redisé›†ç¾¤æ”¯æŒ
- **æ•°æ®åº“åˆ†ç‰‡**: MongoDBåˆ†ç‰‡é›†ç¾¤

## ğŸ” ç›‘æ§è¿ç»´

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
make show-logs

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/app-$(date +%Y-%m-%d).log

# æ¸…ç†æ—¥å¿—æ–‡ä»¶
make clean-logs

# æœç´¢é”™è¯¯æ—¥å¿—
grep "ERROR" logs/app-*.log

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶åˆ—è¡¨
ls -la logs/
```

### é˜Ÿåˆ—ç›‘æ§

```bash
# æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€
make redis-queue-status

# æ¸…ç†é˜Ÿåˆ—
make redis-queue-clear

# å¼ºåˆ¶æ¸…ç†é˜Ÿåˆ—ï¼ˆæ— éœ€ç¡®è®¤ï¼‰
make redis-queue-clear-force
```

## ğŸ†• æœ€æ–°æ›´æ–°

### v2.0.0 - ç°ä»£åŒ–åˆ†å±‚æ¶æ„é‡æ„

- âœ… **CoreåŸºç¡€è®¾æ–½å±‚** - å°†ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿç§»è‡³coreç›®å½•ï¼Œä½œä¸ºæ ¸å¿ƒåŸºç¡€è®¾æ–½
- âœ… **Provider-Serviceåˆ†å±‚** - å®Œå…¨åˆ†ç¦»ä»»åŠ¡åˆ†å‘å’Œå…·ä½“å®ç°èŒè´£
- âœ… **æ¥å£é©±åŠ¨è®¾è®¡** - åŸºäºAITaskDispatcheræ¥å£çš„æ’ä»¶åŒ–æ¶æ„
- âœ… **ç›®å½•ç»“æ„ä¼˜åŒ–** - æ›´æ¸…æ™°çš„åˆ†å±‚ç›®å½•ç»“æ„ï¼ŒèŒè´£æ˜ç¡®
- âœ… **TaskQueueé‡å‘½å** - ä»RedisQueueé‡å‘½åä¸ºTaskQueueï¼Œæ›´é€šç”¨çš„å‘½å
- âœ… **æ¶æ„æ–‡æ¡£å®Œå–„** - è¯¦ç»†çš„æ¶æ„è®¾è®¡ç†å¿µå’Œæ‰©å±•æŒ‡å—

### v1.6.0 - æç®€APIè®¾è®¡

- âœ… **ç§»é™¤å…¼å®¹æ€§æ¥å£** - å»æ‰æ‰€æœ‰ç±»å‹ç‰¹å®šçš„ä»»åŠ¡åˆ—è¡¨æ¥å£ï¼Œé‡‡ç”¨æœ€ç®€æ´çš„è®¾è®¡
- âœ… **ç»Ÿä¸€ä»»åŠ¡åˆ—è¡¨** - åªä¿ç•™ä¸€ä¸ª`GET /ai/tasks`æ¥å£ï¼Œé€šè¿‡`type`å‚æ•°è¿‡æ»¤
- âœ… **æç®€è·¯ç”±** - æ€»å…±åªæœ‰6ä¸ªAPIæ¥å£ï¼ˆ3ä¸ªåˆ›å»º + 3ä¸ªç»Ÿä¸€ï¼‰
- âœ… **çº¿æ€§æ‰©å±•** - APIæ•°é‡éšä»»åŠ¡ç±»å‹çº¿æ€§å¢é•¿ï¼ˆN+3ï¼‰ï¼Œè€Œéä¼ ç»Ÿçš„å¹³æ–¹å¢é•¿ï¼ˆNÃ—4ï¼‰
- âœ… **modelå­—æ®µå¿…å¡«** - ç§»é™¤é»˜è®¤æ¨¡å‹æœºåˆ¶ï¼Œè¦æ±‚ç”¨æˆ·æ˜ç¡®æŒ‡å®šAIæ¨¡å‹
- âœ… **providerå­—æ®µå¿…å¡«** - ç§»é™¤é»˜è®¤æä¾›å•†æœºåˆ¶ï¼Œè¦æ±‚ç”¨æˆ·æ˜ç¡®æŒ‡å®šAIæœåŠ¡æä¾›å•†

### v1.5.0 - ç»Ÿä¸€ä»»åŠ¡ç®¡ç†æ¶æ„é‡æ„

- âœ… **ç»Ÿä¸€Taskæ¨¡å‹** - åˆå¹¶ImageTaskå’ŒVideoTaskä¸ºç»Ÿä¸€çš„Taskæ¨¡å‹
- âœ… **ç»Ÿä¸€TaskService** - ä¸€ä¸ªæœåŠ¡å¤„ç†æ‰€æœ‰ç±»å‹çš„ä»»åŠ¡ï¼ˆå›¾åƒã€è§†é¢‘ã€æ–‡æœ¬ï¼‰
- âœ… **ç®€åŒ–APIè®¾è®¡** - ç»Ÿä¸€çš„ä»»åŠ¡æŸ¥è¯¢å’Œåˆ é™¤æ¥å£ï¼Œæ— éœ€åŒºåˆ†ä»»åŠ¡ç±»å‹
- âœ… **ä¼˜åŒ–æ•°æ®åº“è®¾è®¡** - å•ä¸€tasksé›†åˆå­˜å‚¨æ‰€æœ‰ä»»åŠ¡ï¼Œå‡å°‘å¤æ‚æ€§
- âœ… **æ‰©å±•æ€§å¢å¼º** - æ–°å¢ä»»åŠ¡ç±»å‹æ—¶åªéœ€çº¿æ€§å¢é•¿APIæ•°é‡

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'feat: æ·»åŠ æŸä¸ªç‰¹æ€§'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ Pull Request

### æäº¤è§„èŒƒ

- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ™ è‡´è°¢

- [ç«å±±æ–¹èˆŸ](https://www.volcengine.com/product/ark) - æä¾›å¼ºå¤§çš„AIèƒ½åŠ›
- [ç«å±±å¼•æ“å³æ¢¦AI](https://www.volcengine.com/product/jimeng) - ä¸“ä¸šçº§å›¾åƒç”Ÿæˆ
- [Asynq](https://github.com/hibiken/asynq) - ä¼˜ç§€çš„Goä»»åŠ¡é˜Ÿåˆ—åº“
- [Gin](https://github.com/gin-gonic/gin) - é«˜æ€§èƒ½Webæ¡†æ¶
- [MongoDB](https://www.mongodb.com/) - çµæ´»çš„æ–‡æ¡£æ•°æ®åº“

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªæ˜Ÿæ ‡ï¼

## ğŸ“ è”ç³»æˆ‘ä»¬

- é¡¹ç›®ä¸»é¡µ: [GitHub Repository](https://github.com/your-org/volcengine-go-server)
- é—®é¢˜åé¦ˆ: [Issues](https://github.com/your-org/volcengine-go-server/issues)
- é‚®ç®±: <zimin.zhang2000@gmail.com>

---

## ğŸ³ Docker éƒ¨ç½²

### å•ç‹¬æ„å»ºå’Œè¿è¡Œ

```bash
# æ„å»ºAPIæœåŠ¡å™¨é•œåƒ
make docker-build-server

# æ„å»ºWorkeræœåŠ¡é•œåƒ
make docker-build-worker

# æ„å»ºæ‰€æœ‰é•œåƒ
make docker-build-all

# è¿è¡ŒAPIæœåŠ¡å™¨å®¹å™¨ï¼ˆæš´éœ²8080ç«¯å£ï¼‰
make docker-run-server

# è¿è¡ŒWorkeræœåŠ¡å®¹å™¨ï¼ˆä¸æš´éœ²ç«¯å£ï¼Œåå°ä»»åŠ¡å¤„ç†ï¼‰
make docker-run-worker
```

### ä½¿ç”¨Docker Compose

```bash
# å¯åŠ¨å®Œæ•´æœåŠ¡æ ˆï¼ˆæ¨èï¼‰
make docker-compose-up

# åœæ­¢æ‰€æœ‰æœåŠ¡
make docker-compose-down

# å¯åŠ¨åŒ…å«ç›‘æ§æœåŠ¡çš„å®Œæ•´æ ˆ
docker-compose --profile monitoring up -d
```

### æœåŠ¡æ¶æ„è¯´æ˜

- **APIæœåŠ¡å™¨**: æš´éœ²8080ç«¯å£ï¼Œæä¾›HTTP APIæœåŠ¡
- **WorkeræœåŠ¡**: ä¸æš´éœ²ç«¯å£ï¼Œé€šè¿‡Redisé˜Ÿåˆ—å¤„ç†åå°ä»»åŠ¡
- **MongoDB**: æ•°æ®æŒä¹…åŒ–å­˜å‚¨
- **Redis**: ç¼“å­˜å’Œä»»åŠ¡é˜Ÿåˆ—
- **ç›‘æ§æœåŠ¡**: å¯é€‰çš„Prometheus + Grafanaç›‘æ§æ ˆ
